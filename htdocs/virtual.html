<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="author" content="Reyes-Castillo">
  <meta name="keywords" content="html">
  <meta name="revised" content="28-09-2022">

  <title>Virual Cube - SimplyCube</title>

  <link rel="icon" type="image/gif" href="../images/logo.png">
  <link rel="stylesheet" type="text/css" href="../css/main.css">
</head>

<body>
  <div id="header">
    <a href="../">
      <img id="home-button" width=30 height=30 src="../images/logo.png"></img>
    </a>
    <p>SimplyCube</p>
    <ul id="nav-buttons">
      <li>
        <p>Beginner</p>
        <div class="nav-dropdown-content">
          <a href="../htdocs/beginner.html">Beginner Tutorial</a>
          <a href="../htdocs/notation.html">Notation</a>
        </div>
      </li>
      <li>
        <p>Advanced</p>
        <div class="nav-dropdown-content">
          <a href="../htdocs/cfop.html">CFOP Tutorial</a>
          <a href="../htdocs/pll.html">PLL</a>
          <a href="../htdocs/oll.html">OLL</a>
        </div>
      </li>
      <li>
        <p>Practice</p>
        <div class="nav-dropdown-content">
          <a href="../htdocs/timer.html">Timer</a>
          <a href="../htdocs/virtual.html">Virtual Cube</a>
        </div>
      </li>
    </ul>
  </div>
  <canvas width="600px" height="600px" id="c"></canvas><br>

  <label>Moves</label><br>
  <input type="text" id="text"><br>
  <button id="button">Enter</button><br>
  <button id="toggle">Disable controls</button>

  <script type="module">
    import {Cube} from "../js/cube.js"
    var camera = {};
    var cube = {};

    let toggled = true;

    function click() {
      let value = document.getElementById("text").value;
      console.log(value);
      let move = "";

      for (let i = 0; i < value.length; i++) {
        if (value.charAt(i).toLowerCase() != value.charAt(i).toUpperCase() && move.length > 0) {
          console.log(move);
          cube.turnFace(move);
          move = "";
        }
        move += value.charAt(i);
      }
      cube.turnFace(move);
      console.log(JSON.stringify(cube.stickers));
      cube.draw(document.getElementById("c"), camera);
    }

    function toggleControls() {
      let button = document.getElementById("toggle");

      toggled = !toggled;
      if (toggled) button.innerHTML = "Disable Controls";
      else button.innerHTML = "Enable Controls";
    }

    window.onload = function () {
      camera = {
        x: 3,
        y: 3,
        z: 3,
        yaw: 135,
        pitch: 320,
        roll: 0,
        fov: 80,
        width: 600,
        height: 600
      };
      cube = new Cube("");
      cube.draw(document.getElementById("c"), camera);
      document.getElementById("button").onclick = function () {click();};
      document.getElementById("toggle").onclick = function () {toggleControls();};
    };

    window.onkeydown = function (e) {
      const step = 0.5;

      if (!toggled) return;
      if (e.code == "KeyA") camera.x -= step;
      else if (e.code == "KeyD") camera.x += step;
      else if (e.code == "KeyW") camera.y -= step;
      else if (e.code == "KeyS") camera.y += step;
      else if (e.code == "KeyR") camera.z -= step;
      else if (e.code == "KeyT") camera.z += step;
      else if (e.code == "KeyZ") camera.yaw -= step;
      else if (e.code == "KeyX") camera.yaw += step;
      else if (e.code == "KeyC") camera.pitch -= step;
      else if (e.code == "KeyV") camera.pitch += step;
      else if (e.code == "KeyB") camera.fov -= step;
      else if (e.code == "KeyN") camera.fov += step;
      else return;

      if (camera.yaw < 0) camera.yaw = 360;
      if (camera.pitch < 0) camera.pitch = 360;
      if (camera.roll < 0) camera.roll = 360;

      let t = new Date().getTime();
      cube.draw(document.getElementById("c"), camera);

      console.log("x: " + camera.x + " y: " + camera.y + " z: " + camera.z);
      console.log("yaw: " + camera.yaw + " pitch: " + camera.pitch);
      console.log("fov: " + camera.fov);
      console.log("Time Elapsed: " + (new Date().getTime() - t));
    };
  </script>
</body>

</html>