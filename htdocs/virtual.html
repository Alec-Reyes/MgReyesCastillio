<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
	<meta name="author" content="Lukas Castillo, Alec Reyes">
	<meta name="keywords" content="Rubik's Cube, Cubing, Speedcubing">
  <meta name="description" content="A beginners guide to solving a Rubik's Cube">
	<meta name="revised" content="27-10-2022">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Virual Cube - SimplyCube</title>

  <link rel="icon" type="image/gif" href="../images/logo.png">
  <link rel="stylesheet" type="text/css" href="../css/main.css">
</head>

<body>
  <!--Header-->
  <header>
    <a href="../">
      <img id="home-button" width=30 height=30 src="../images/logo.png"></img>
    </a>
    <p>SimplyCube</p>
    <button id="menu-button">Menu</button>
    <ul id="nav-buttons">
      <li>
        <p>Beginner</p>
        <div class="nav-dropdown-content">
          <a href="../htdocs/beginner.html">Beginner Tutorial</a>
          <a href="../htdocs/notation.html">Notation</a>
        </div>
      </li>
      <li>
        <p>Advanced</p>
        <div class="nav-dropdown-content">
          <a href="../htdocs/cfop.html">CFOP Tutorial</a>
          <a href="../htdocs/pll.html">PLL</a>
          <a href="../htdocs/oll.html">OLL</a>
        </div>
      </li>
      <li>
        <p>Practice</p>
        <div class="nav-dropdown-content">
          <a href="../htdocs/timer.html">Timer</a>
          <a href="../htdocs/virtual.html">Virtual Cube</a>
        </div>
      </li>
    </ul>
  </header>
  
  <div id="content">
    <canvas width="600px" height="600px" id="c"></canvas><br>

    <label>Moves</label><br>
    <input type="text" id="text"><br>
    <button id="button">Enter</button><br>
    <button id="toggle">Disable controls</button><br>
    <button id="clear">Reset</button>
  </div>

  <!--Footer-->
  <footer>
    <div>
      <h2>Contact Us:</h2>
      b2026slccastillo@pshs.edu.ph <br>
      b2026andreyes@pshs.edu.ph
    </div>
    <div>
      <h2>Copyright &copy; 2022</h2>
    </div>
    <div>
      <h2>Other Links:</h2>
      <a href="https://github.com/Alec-Reyes/MgReyesCastillio"> Github </a> <br>
      <a href="htdocs/sources.html"> Sources </a>
    </div>
  </footer>

  <script type="module">
    import {Cube, Camera, rotateCameraByMouse, convertMoves} from "../js/cube.js"
    var camera = {};
    var cube = {};
    //milliseconds per frame
    const MPF = 10;
    //turns per second
    const TPS = 3;

    let toggled = true;

    function setTurns() {
      let value = document.getElementById("text").value;
      let moves = convertMoves(value);
      if(moves == null){
        
      }else{
        cube.instantComplete();
        cube.setTurns(moves);
      }
    }

    function toggleControls() {
      let button = document.getElementById("toggle");

      toggled = !toggled;
      if (toggled) button.innerHTML = "Disable Controls";
      else button.innerHTML = "Enable Controls";
    }

    if(!window.toload) window.toload = [];
    
    window.toload.push(function () {
      let canvas = document.getElementById("c");
      
      camera = new Camera(3, 3, 0, 135, 0, 0, 80, 600, 600);
      
      cube = new Cube("");
      cube.draw(canvas, camera, TPS);
      
      document.getElementById("button").onclick = function () {setTurns()};
      document.getElementById("toggle").onclick = function () {toggleControls()};
      document.getElementById("clear").onclick = function() {cube.clear([])};
      canvas.onmousemove = function(e){rotateCameraByMouse(camera, [3, 3, 0], e)};

      setInterval(() => {
        //camera.rotArPoint(0, 1, 0, [0, 0, 0]);
        camera.lookAtOrigin();
        cube.draw(canvas, camera, TPS);
        //console.log(camera.pitch);
      }, MPF);
    });

    window.onkeydown = function (e) {
      const step = 0.5;

      if (!toggled) return;
      if (e.code == "KeyA") camera.x -= step;
      else if (e.code == "KeyD") camera.x += step;
      else if (e.code == "KeyW") camera.y -= step;
      else if (e.code == "KeyS") camera.y += step;
      else if (e.code == "KeyR") camera.z -= step;
      else if (e.code == "KeyT") camera.z += step;
      else if (e.code == "KeyZ") camera.yaw -= step;
      else if (e.code == "KeyX") camera.yaw += step;
      else if (e.code == "KeyC") camera.pitch -= step;
      else if (e.code == "KeyV") camera.pitch += step;
      else if (e.code == "KeyB") camera.fov -= step;
      else if (e.code == "KeyN") camera.fov += step;
      else return;

      if (camera.yaw < 0) camera.yaw = 360;
      if (camera.pitch < 0) camera.pitch = 360;
      if (camera.roll < 0) camera.roll = 360;

      //let t = new Date().getTime();
      //cube.draw(document.getElementById("c"), camera, TPS);

      console.log("x: " + camera.x + " y: " + camera.y + " z: " + camera.z);
      console.log("yaw: " + camera.yaw + " pitch: " + camera.pitch);
      console.log("fov: " + camera.fov);
      //console.log("Time Elapsed: " + (new Date().getTime() - t));
    };
  </script>
  <script src="../js/script.js"></script>
</body>

</html>